<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Live - Painel do Barbeiro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 3px;
            overflow-x: auto;
            max-height: 200px;
            overflow-y: auto;
        }
        .log {
            margin: 5px 0;
            padding: 8px;
            border-radius: 3px;
        }
        .step {
            background-color: #e9ecef;
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #007bff;
        }
        .status {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 3px;
            display: inline-block;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Teste Live - Painel do Barbeiro</h1>
        <p>Esta p√°gina verifica em tempo real se a aba "Painel do Barbeiro" est√° funcionando.</p>
        
        <div class="test-section">
            <h3>üìã Status Atual</h3>
            <div id="status-display"></div>
            <button onclick="checkCurrentStatus()">üîÑ Atualizar Status</button>
            <button onclick="goToAuth()">üîê Ir para Login</button>
            <button onclick="goToProfile()">üë§ Ir para Perfil</button>
        </div>
        
        <div class="test-section">
            <h3>üß™ Testes Autom√°ticos</h3>
            <button onclick="runLiveTest()">üöÄ Executar Teste Completo</button>
            <button onclick="clearLogs()">üóëÔ∏è Limpar Logs</button>
        </div>
        
        <div class="test-section">
            <h3>üìù Instru√ß√µes</h3>
            <div class="step">
                <strong>1.</strong> Fa√ßa login com: <code>barbeiro@smoothcuts.com</code> / <code>123456</code>
            </div>
            <div class="step">
                <strong>2.</strong> V√° para a p√°gina de perfil
            </div>
            <div class="step">
                <strong>3.</strong> Execute o teste para verificar se a aba aparece
            </div>
        </div>
        
        <div id="logs"></div>
    </div>

    <script>
        // Configura√ß√£o dos barbeiros (copiada do c√≥digo original)
        const BARBER_CONFIG = {
            authorizedBarbers: [
                {
                    id: 'default-barber',
                    email: 'barbeiro@mateusbarber.com',
                    name: 'Barbeiro Padr√£o',
                    permissions: ['view_appointments']
                },
                {
                    id: 'smoothcuts-barber',
                    email: 'barbeiro@smoothcuts.com',
                    name: 'Barbeiro SmoothCuts',
                    permissions: ['view_appointments']
                },
                {
                    id: 'joao-barber',
                    email: 'joao@mateusbarber.com',
                    name: 'Jo√£o',
                    permissions: ['view_appointments']
                },
                {
                    id: 'pedro-barber',
                    email: 'pedro@mateusbarber.com',
                    name: 'Pedro',
                    permissions: ['view_appointments']
                }
            ]
        };

        const isBarber = (email) => {
            if (!email) return false;
            return BARBER_CONFIG.authorizedBarbers.some(barber => barber.email === email);
        };

        function log(message, type = 'info') {
            const logsDiv = document.getElementById('logs');
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function updateStatus(message, type) {
            const statusDiv = document.getElementById('status-display');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function goToAuth() {
            window.open('/auth', '_blank');
        }

        function goToProfile() {
            window.open('/profile', '_blank');
        }

        function checkCurrentStatus() {
            log('=== VERIFICANDO STATUS ATUAL ===', 'info');
            
            // Verificar se estamos na p√°gina correta
            log(`P√°gina atual: ${window.location.pathname}`);
            
            // Verificar localStorage do Supabase
            const supabaseKeys = Object.keys(localStorage).filter(key => 
                key.includes('supabase') || key.includes('auth')
            );
            
            if (supabaseKeys.length === 0) {
                updateStatus('‚ùå Usu√°rio n√£o est√° logado', 'error');
                log('‚ùå Nenhuma sess√£o do Supabase encontrada', 'error');
                return;
            }
            
            let userEmail = null;
            let isLoggedIn = false;
            
            // Procurar pelo email do usu√°rio
            supabaseKeys.forEach(key => {
                try {
                    const value = localStorage.getItem(key);
                    if (value) {
                        const parsed = JSON.parse(value);
                        if (parsed.user && parsed.user.email) {
                            userEmail = parsed.user.email;
                            isLoggedIn = true;
                            log(`‚úÖ Usu√°rio logado: ${userEmail}`, 'success');
                        }
                    }
                } catch (e) {
                    // Ignorar erros de parse
                }
            });
            
            if (!isLoggedIn) {
                updateStatus('‚ùå Usu√°rio n√£o est√° logado', 'error');
                log('‚ùå N√£o foi poss√≠vel encontrar dados do usu√°rio', 'error');
                return;
            }
            
            // Verificar se √© barbeiro
            const isBarbeiro = isBarber(userEmail);
            if (isBarbeiro) {
                updateStatus(`‚úÖ ${userEmail} √© um barbeiro autorizado`, 'success');
                log(`‚úÖ ${userEmail} √© um barbeiro autorizado`, 'success');
                
                // Verificar se estamos na p√°gina de perfil
                if (window.location.pathname === '/profile') {
                    // Verificar se a aba existe
                    setTimeout(() => {
                        const barberTab = document.querySelector('[value="barber"]');
                        if (barberTab) {
                            log('‚úÖ Aba "Painel do Barbeiro" encontrada na p√°gina!', 'success');
                            updateStatus('‚úÖ Aba do barbeiro est√° vis√≠vel', 'success');
                        } else {
                            log('‚ùå Aba "Painel do Barbeiro" N√ÉO encontrada na p√°gina!', 'error');
                            updateStatus('‚ùå Aba do barbeiro n√£o est√° vis√≠vel', 'error');
                        }
                    }, 1000);
                } else {
                    log('‚ö†Ô∏è N√£o estamos na p√°gina de perfil. V√° para /profile para testar', 'warning');
                }
            } else {
                updateStatus(`‚ùå ${userEmail} N√ÉO √© um barbeiro autorizado`, 'error');
                log(`‚ùå ${userEmail} N√ÉO √© um barbeiro autorizado`, 'error');
                log('Lista de barbeiros autorizados:');
                BARBER_CONFIG.authorizedBarbers.forEach(barber => {
                    log(`- ${barber.email}`);
                });
            }
        }

        function runLiveTest() {
            log('üöÄ EXECUTANDO TESTE COMPLETO', 'info');
            log('='.repeat(50));
            
            checkCurrentStatus();
            
            // Verificar se a fun√ß√£o isBarber est√° funcionando
            log('\n=== TESTANDO FUN√á√ÉO isBarber ===', 'info');
            const testEmails = [
                'barbeiro@smoothcuts.com',
                'barbeiro@mateusbarber.com',
                'joao@mateusbarber.com',
                'pedro@mateusbarber.com',
                'usuario@normal.com'
            ];
            
            testEmails.forEach(email => {
                const result = isBarber(email);
                if (result) {
                    log(`‚úÖ ${email} ‚Üí √â barbeiro`, 'success');
                } else {
                    log(`‚ùå ${email} ‚Üí N√ÉO √© barbeiro`);
                }
            });
            
            log('\n=== VERIFICANDO DOM ===', 'info');
            
            // Verificar se estamos na p√°gina de perfil
            if (window.location.pathname === '/profile') {
                log('‚úÖ Estamos na p√°gina de perfil', 'success');
                
                // Aguardar um pouco para o React renderizar
                setTimeout(() => {
                    const tabs = document.querySelectorAll('[role="tab"]');
                    log(`Encontradas ${tabs.length} abas:`);
                    
                    tabs.forEach((tab, index) => {
                        const text = tab.textContent.trim();
                        log(`  Aba ${index + 1}: "${text}"`);
                        
                        if (text.includes('Painel do Barbeiro')) {
                            log('  ‚úÖ Aba "Painel do Barbeiro" encontrada!', 'success');
                        }
                    });
                    
                    // Verificar especificamente pela aba do barbeiro
                    const barberTab = document.querySelector('[value="barber"]');
                    if (barberTab) {
                        log('‚úÖ Elemento da aba do barbeiro encontrado no DOM!', 'success');
                        log(`Texto da aba: "${barberTab.textContent.trim()}"`);
                    } else {
                        log('‚ùå Elemento da aba do barbeiro N√ÉO encontrado no DOM!', 'error');
                    }
                    
                    log('\n=== TESTE FINALIZADO ===', 'info');
                    log('='.repeat(50));
                }, 2000);
            } else {
                log('‚ö†Ô∏è N√£o estamos na p√°gina de perfil', 'warning');
                log('Abra a p√°gina /profile para executar o teste completo');
            }
        }

        // Auto-executar verifica√ß√£o ao carregar
        window.onload = function() {
            log('üîç P√°gina de teste carregada', 'info');
            checkCurrentStatus();
        };
    </script>
</body>
</html>